<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>家計簿アプリ</title>
</head>
<body>
<h2>家計簿アプリ</h2>

<!-- 入力フォーム -->
商品名：<input id="item"><br>
値段：<input id="price" type="number"><br>
産地：<input id="origin"><br>
<button id="addBtn">追加</button>

<hr>

<h3>登録リスト</h3>
<table border="1" id="list">
  <tr>
    <th>ID</th>
    <th>商品名</th>
    <th>値段</th>
    <th>産地</th>
    <th>日付</th>
  </tr>
</table>

<script>
// --- IndexedDB を開く or 作成 ---
let db;
const request = indexedDB.open("kakeiboDB", 1);

request.onupgradeneeded = function (event) {
  db = event.target.result;
  // 主キー id（自動採番）
  db.createObjectStore("items", { keyPath: "id", autoIncrement: true });
};

request.onsuccess = function (event) {
  db = event.target.result;
  loadList();  // 起動時に一覧表示
};

// --- データ追加 ---
document.getElementById("addBtn").onclick = function () {
  const item = document.getElementById("item").value;
  const price = Number(document.getElementById("price").value);
  const origin = document.getElementById("origin").value;
  const date = new Date().toISOString().split("T")[0];

  const tx = db.transaction("items", "readwrite");
  const store = tx.objectStore("items");
  store.add({ item, price, origin, date });

  tx.oncomplete = () => {
    loadList(); // 追加後に一覧更新
  };
};

// --- 一覧読み込み ---
function loadList() {
  const table = document.getElementById("list");

  // 以前の表示を消してヘッダを残す
  table.innerHTML = `
    <tr>
      <th>ID</th>
      <th>商品名</th>
      <th>値段</th>
      <th>産地</th>
      <th>日付</th>
    </tr>
  `;

  const tx = db.transaction("items", "readonly");
  const store = tx.objectStore("items");

  store.openCursor().onsuccess = function (event) {
    const cursor = event.target.result;
    if (cursor) {
      const row = table.insertRow();
      row.insertCell().textContent = cursor.value.id;
      row.insertCell().textContent = cursor.value.item;
      row.insertCell().textContent = cursor.value.price;
      row.insertCell().textContent = cursor.value.origin;
      row.insertCell().textContent = cursor.value.date;

      cursor.continue();
    }
  };
}
</script>

</body>
</html>
